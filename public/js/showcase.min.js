/*! teechio-dashboard-260.2014-11-16 */
!function(a){"use strict";var b="2014-09-15",c=moment.utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",d=angular.module("teechioShowcase",[]);d.config(["$interpolateProvider",function(a){a.startSymbol("{[").endSymbol("]}")}]),d.factory("$acache",["$cacheFactory",function(){return{get:function(a){var b=localStorage.getItem(a);try{return b=JSON.parse(localStorage.getItem(a))}catch(c){return b}},put:function(a,b){"string"==typeof b?localStorage.setItem(a,b):localStorage.setItem(a,JSON.stringify(b))},remove:function(a){localStorage.removeItem(a)}}}]),d.directive("usersActivity",["$http",function(a){return{restrict:"EA",link:function(d,e){var f={startDate:b,endDate:c,aggregate:"%23count",group:"date",sort:"date"};a.get("/demo/analytics",{params:f}).success(function(a){AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:a,pathToImages:"http://www.amcharts.com/lib/3/images/",graphs:[{fillAlphas:1,valueField:"count",lineColor:"#FFFFFF"}],chartCursor:{categoryBalloonDateFormat:"DD MMMM",cursorPosition:"mouse"},valueAxes:[{position:"left",labelsEnabled:!1,gridAlpha:0,axisAlpha:0}],categoryField:"date",categoryAxis:{minPeriod:"DD",parseDates:!0,gridAlpha:0,axisAlpha:.4}})}).error(function(){})}}}]),d.directive("topFiveCorrect",["$http",function(a){return{restrict:"EA",link:function(d,e){var f={startDate:b,endDate:c,aggregate:"%23count",filters:"action.action %23eq responsetrue",group:"session.usermail",sort:"count:-1",pageSize:5};a.get("/demo/analytics",{params:f}).success(function(a){AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:a,pathToImages:"http://www.amcharts.com/lib/3/images/",valueAxes:[{position:"left",title:"",maximum:a[0].count,autoGridCount:!1,gridCount:20,labelsEnabled:!1,gridAlpha:0}],startDuration:1,graphs:[{fillAlphas:.9,type:"column",valueField:"count",lineColor:"#72C23A"}],rotate:!0,chartCursor:{categoryBalloonDateEnabled:!1,cursorAlpha:0,zoomable:!1},categoryField:"session_usermail",categoryAxis:{gridPosition:"start",gridAlpha:.3}})}).error(function(){})}}}]),d.directive("topFiveWrong",["$http",function(a){return{restrict:"EA",link:function(d,e){var f={startDate:b,endDate:c,aggregate:"%23count",filters:"action.action %23eq responsefalse",group:"session.usermail",sort:"count:-1",pageSize:5};a.get("/demo/analytics",{params:f}).success(function(a){AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:a,pathToImages:"http://www.amcharts.com/lib/3/images/",valueAxes:[{position:"left",title:"",maximum:a[0].count,autoGridCount:!1,gridCount:20,labelsEnabled:!1,gridAlpha:0}],startDuration:1,graphs:[{fillAlphas:.9,type:"column",valueField:"count",lineColor:"#cc3333"}],rotate:!0,chartCursor:{categoryBalloonDateEnabled:!1,cursorAlpha:0,zoomable:!1},categoryField:"session_usermail",categoryAxis:{gridPosition:"start",gridAlpha:.3}})}).error(function(){})}}}]),d.directive("topFiveFastest",["$http",function(a){return{restrict:"EA",link:function(d,e){var f={startDate:b,endDate:c,aggregate:"%23count,%23avg(action.duration)",filters:"(action.action %23eq responsetrue %23or action.action %23eq responsefalse)",group:"session.usermail",postProcessingFilters:"count %23gte 10",select:"avg.action.duration,session.usermail",sort:"avg.action.duration",pageSize:5};a.get("/demo/analytics",{params:f}).success(function(a){var b=[];$.each(a,function(a,c){b.push({usermail:c.session_usermail,avgActionDuration:d3.format(".1f")(c.avg_action_duration/1e3)})});AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:b,pathToImages:"http://www.amcharts.com/lib/3/images/",valueAxes:[{position:"left",title:"",maximum:_.findLast(b,function(a){return a.avgActionDuration}),autoGridCount:!1,gridCount:20,labelsEnabled:!1,gridAlpha:0}],startDuration:1,graphs:[{fillAlphas:.9,type:"column",valueField:"avgActionDuration",lineColor:"#1576BD"}],rotate:!0,chartCursor:{categoryBalloonDateEnabled:!1,cursorAlpha:0,zoomable:!1},categoryField:"usermail",categoryAxis:{gridPosition:"start",gridAlpha:.3}})}).error(function(){})}}}]),d.directive("usersHintsAvg",["$http",function(a){return{restrict:"EA",link:function(d,e){function f(b,c,d){var e={startDate:b,endDate:c,aggregate:"%23count",group:"session.usermail",sort:"session.usermail"};a.get("/demo/analytics",{params:e}).success(function(a){d(null,b,c,a)}).error(function(a){d(a,null)})}function g(b,c,d,e){var f={startDate:b,endDate:c,aggregate:"%23sum(action.hintNumber)",filters:"action.action %23eq hint",group:"session.usermail",sort:"session.usermail"};a.get("/demo/analytics",{params:f}).success(function(a){var b=[];$.each(a,function(a,c){$.each(d,function(a,d){if(d.session_usermail==c.session_usermail){if(c.count=d.count,c.avgHintsPerSession=c.sum_action_hintNumber/c.count,c.avgHintsPerSession>0){var e={name:c.session_usermail,value:Math.round(100*c.avgHintsPerSession)/100,y:2*Math.random()+5,x:2*Math.random()+5};b.push(e)}return!1}})}),e(null,b)}).error(function(a){e(a,null)})}var h=async.compose(g,f);h(b,c,function(a,b){AmCharts.makeChart(e.attr("id"),{type:"xy",pathToImages:"http://www.amcharts.com/lib/3/images/",theme:"none",dataProvider:b,startDuration:1.5,valueAxes:[{position:"bottom",axisAlpha:0,labelsEnabled:!1},{position:"left",axisAlpha:0,labelsEnabled:!1}],graphs:[{balloonText:"user:<b>[[name]]</b>, hints: <b>[[value]]</b>",bullet:"circle",bulletBorderAlpha:.6,bulletAlpha:.2,lineAlpha:0,fillAlphas:0,valueField:"value",xField:"x",yField:"y",maxBulletSize:100,lineColor:"#FFFFFF"}],marginLeft:46,marginBottom:35})})}}}]),d.directive("usersList",["$http",function(a){return{restrict:"EA",link:function(d){var e={startDate:b,endDate:c,aggregate:"%23count",group:"session.usermail,session._id",select:"session.usermail,session._id",sort:"count:-1,session.usermail",postProcessingFilters:"count %23gte 5"};a.get("/demo/analytics",{params:e}).success(function(a){d.users=[],angular.forEach(a,function(a){if(a.session_usermail){var b={username:a.session_usermail,slug:a.session_usermail.replace(" ","_")};d.users.push(b)}})}).error(function(){console.log("error loading users")})}}}]),d.directive("answersDay",["$http",function(a){return{restrict:"EA",link:function(d,e){function f(a,b){a.zoomToIndexes(b.length-10,b.length-1)}var g={startDate:b,endDate:c,aggregate:"%23count",filters:"(action.action %23eq responsetrue %23or action.action %23eq responsefalse) %23and session.usermail %23eq ",group:"date,action.action",sort:"date:1",filtered:d.user};a.get("/demo/analytics",{params:g}).success(function(a){var b={};$.each(a,function(a,c){b[c.date]||(b[c.date]={correct:0,wrong:0}),"responsetrue"==c.action_action?b[c.date].correct=c.count:"responsefalse"==c.action_action&&(b[c.date].wrong=c.count)});var c=[];$.each(b,function(a,b){c.push({date:a,correct:b.correct,wrong:b.wrong})});var d=AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:c,dataDateFormat:"YYYY-MM-DD",pathToImages:"http://www.amcharts.com/lib/3/images/",valueAxes:[{position:"left",title:"",autoGridCount:!1,gridCount:20,labelsEnabled:!1,gridAlpha:0,axisAlpha:0}],startDuration:1,graphs:[{balloonText:"Wrong: <b>[[value]]</b>",fillAlphas:.9,type:"column",valueField:"wrong",lineColor:"#cc3333"},{balloonText:"Correct: <b>[[value]]</b>",fillAlphas:.9,type:"column",clustered:!1,columnWidth:.5,valueField:"correct",lineColor:"#72C23A"}],chartScrollbar:{autoGridCount:!0,graph:"g1",scrollbarHeight:25},chartCursor:{categoryBalloonDateEnabled:!1,cursorAlpha:0,zoomable:!1},categoryField:"date",categoryAxis:{parseDates:!0,gridPosition:"start",gridAlpha:.3}});d.addListener("rendered",f),f(d,c)}).error(function(){})}}}]),d.directive("hintsCorrectSession",["$http",function(a){return{restrict:"EA",link:function(d,e){function f(a,b){a.zoomToIndexes(b.length-10,b.length-1)}function g(b,c,d,e){var f={startDate:b,endDate:c,aggregate:"%23sum(action.hintNumber)",filters:"action.action %23eq hint %23and session.usermail %23eq ",group:"session._id,date",sort:"session._id",filtered:d};a.get("/demo/analytics",{params:f}).success(function(a){var f={};$.each(a,function(a,b){f[b.session__id]={correct:0,hints:b.sum_action_hintNumber,date:b.date}}),e(null,b,c,d,f)}).error(function(a){e(a,null)})}function h(b,c,d,e,f){var g={startDate:b,endDate:c,aggregate:"%23count",filters:"action.action %23eq responsetrue %23and session.usermail %23eq ",group:"session._id,date",sort:"session._id",filtered:d};a.get("/demo/analytics",{params:g}).success(function(a){$.each(a,function(a,b){e[b.session__id]?e[b.session__id].correct=b.count:e[b.session__id]={correct:b.count,hints:0,date:b.date}});var b=1,c=[];$.each(e,function(a,d){c.push({game:"#"+b++,correct:d.correct,hints:d.hints,date:d.date})}),f(null,c)}).error(function(a){f(a,null)})}var i=async.compose(h,g);i(b,c,d.user,function(a,b){if(!a){var c=AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:b,pathToImages:"http://www.amcharts.com/lib/3/images/",valueAxes:[{position:"left",title:"",labelsEnabled:!1,gridAlpha:0,axisAlpha:0}],startDuration:1,graphs:[{id:"g1",balloonText:"Hints: <b>[[value]]</b>",fillAlphas:.9,type:"column",valueField:"hints",lineColor:"#FDD202"},{balloonText:"Game played on: <b>[[date]]</b>; Correct answers: <b>[[value]]</b>",fillAlphas:0,bullet:"round",dashLengthField:"dashLengthLine",valueField:"correct",lineColor:"#72C23A"}],chartScrollbar:{autoGridCount:!0,graph:"g1",scrollbarHeight:25},chartCursor:{currentPosition:"mouse"},categoryField:"game",categoryAxis:{gridPosition:"start",gridAlpha:.3}});c.addListener("rendered",f),f(c,b)}})}}}]),d.directive("hintsWord",["$http",function(a){return{restrict:"EA",link:function(d,e){var f={startDate:b,endDate:c,aggregate:"%23sum(action.hintNumber)",filters:"action.action %23eq hint %23and session.usermail %23eq ",group:"material.title",sort:"sum_action_hintNumber:-1",filtered:d.user};a.get("/demo/analytics",{params:f}).success(function(a){d.saved_words=a.length;AmCharts.makeChart(e.attr("id"),{type:"serial",dataProvider:a,pathToImages:"http://www.amcharts.com/lib/3/images/",valueAxes:[{position:"left",title:"",autoGridCount:!1,gridCount:20,labelsEnabled:!1,gridAlpha:0,axisAlpha:0}],startDuration:1,graphs:[{balloonText:"Hints for <b>[[material_title]]</b>: [[value]]",fillAlphas:1,type:"column",valueField:"sum_action_hintNumber",lineColor:"#FFFFFF",columnWidth:.4}],chartCursor:{categoryBalloonEnabled:!1,cursorAlpha:0,zoomable:!0},categoryField:"sum_action_hintNumber",categoryAxis:{gridPosition:"start",gridAlpha:0,axisAlpha:0,labelsEnabled:!1}})}).error(function(){})}}}]),d.directive("avgWidgets",["$http",function(a){return{restrict:"EA",link:function(d){function e(b,c,e,f){function g(b,c,e,f,g){var h={startDate:b,endDate:c,aggregate:"%23count",filters:"session.usermail %23eq ",group:"session.usermail",filtered:f,method:"/sessions"};a.get("/demo/analytics",{params:h}).success(function(a){var h=0,i=a[0]&&a[0].count?a[0].count:0;i>0&&(h=d3.format(".1f")(e/i)),d.avgCorrect=h,g(null,b,c,f,i)}).error(function(a){g(a,null)})}var h={startDate:b,endDate:c,aggregate:"%23count",filters:"action.action %23eq responsetrue %23and session.usermail %23eq ",group:"action.action",filtered:e};a.get("/demo/analytics",{params:h}).success(function(a){var d=a[0]&&a[0].count?a[0].count:0;g(b,c,d,e,f)}).error(function(a){f(a,null)})}function f(b,c,e,f,g){var h={startDate:b,endDate:c,aggregate:"%23count",filters:"action.action %23eq responsefalse %23and session.usermail %23eq ",group:"action.action",filtered:e};a.get("/demo/analytics",{params:h}).success(function(a){var b=0,c=a[0]&&a[0].count?a[0].count:0;f>0&&(b=d3.format(".1f")(c/f)),d.avgWrong=b,g(null,{})}).error(function(a){g(a,null)})}function g(b,c,e,f){var g={startDate:b,endDate:c,aggregate:"%23avg(action.duration)",filters:"session.usermail %23eq ",group:"session.usermail",filtered:e};a.get("/demo/analytics",{params:g}).success(function(a){var g=0;a[0]&&a[0].avg_action_duration>0&&(g=Math.round(a[0].avg_action_duration/1e3)),d.avgDuration=g,f(null,b,c,e)}).error(function(a){f(a,null)})}var h=async.compose(f,e,g);h(b,c,d.user,function(){})}}}]),a.teechioShowcase=d}(window,document);